{% if domain.www %}
server {
    listen 80;
    server_name {{ domain.www }};

    return 301 https://{{ domain.root }}$request_uri;
}

server {
    listen 443 ssl;
    server_name {{ domain.www }};

    include {{ configs.ssl_params.rel_path }};
    ssl_certificate /etc/letsencrypt/live/{{ domain.root }}/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/{{ domain.root }}/privkey.pem;

    return 301 https://{{ domain.root }}$request_uri;
}

{% endif %}

server {
    listen 80;
    server_name {{ domain.root }};

    return 301 https://{{ domain.root }}$request_uri;
}

server {
    listen 443 ssl;
    server_name {{ domain.root }};

    include {{ configs.ssl_params.rel_path }};
    ssl_certificate /etc/letsencrypt/live/{{ domain.root }}/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/{{ domain.root }}/privkey.pem;

    include {{ configs.core.rel_path }};
}
